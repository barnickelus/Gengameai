<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Genesis Evolution â€“ Neon Glow Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <style>
    html,body {
      margin: 0; padding: 0; height: 100%;
      background: #060616; overflow: hidden;
      font-family: "Inter", Arial, sans-serif;
    }
    canvas {
      display: block; width: 100%; height: 100%;
      touch-action: none;
      background: radial-gradient(circle at center, #32005a 0%, #000 85%);
    }
    #hud {
      position: fixed; top: 14px; left: 18px;
      color: #fff; font-size: 15px;
      text-shadow: 0 0 4px rgba(255,255,255,.3);
    }
    #effBar {
      position: fixed; bottom: 14px; left: 18px;
      width: 220px; height: 18px;
      background: rgba(255,255,255,.12); border-radius: 9px;
    }
    #effFill {
      height: 100%; width: 100%;
      background: #00e4b8; border-radius: 9px;
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud">Mass: <span id="mass">10</span> Score: <span id="score">0</span> Level: <span id="level">1</span></div>
<div id="effBar"><div id="effFill"></div></div>
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>

<script>
/* ---------- Canvas ---------- */
const canvas = document.getElementById('game'), ctx = canvas.getContext('2d');
let W,H; function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
addEventListener('resize',resize); resize();

/* ---------- Player ---------- */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5};
let target={x:0,y:0}, offset={x:W/2,y:H/2};

/* ---------- Food Pools ---------- */
const neonFood=[], yellowFood=[];
const NEON_COLORS=["#00e4b8","#0ff","#00faff","#22e"];

/* initial spawn */
for(let i=0;i<70;i++) spawnNeon(); 
for(let i=0;i<60;i++) spawnYellow();

/* ---------- Spawn fns ---------- */
function spawnNeon(){
  neonFood.push({
    baseR:90+Math.random()*200,
    angle:Math.random()*Math.PI*2,
    angV:0.002+Math.random()*0.004,
    seed:Math.random()*Math.PI*2,
    size:3,
    col:NEON_COLORS[~~(Math.random()*NEON_COLORS.length)]
  });
}
function spawnYellow(){
  yellowFood.push({
    baseR:250+Math.random()*600,
    angle:Math.random()*Math.PI*2,
    angV:0.0006+Math.random()*0.001,
    size:6,
    col:"#ff0"
  });
}

/* ---------- Input ---------- */
["mousedown","touchstart"].forEach(e=>canvas.addEventListener(e,setT));
["mousemove","touchmove"].forEach(e=>canvas.addEventListener(e,e2=>e2.buttons&&setT(e2)));
function setT(e){
  const p=e.touches?e.touches[0]:e;
  target.x=p.clientX-offset.x; target.y=p.clientY-offset.y;
  e.preventDefault();
}

/* ---------- Loop ---------- */
let last=0, level=1, flash=0;
function loop(t){
  const dt=(t-last)||16; last=t;

  /* ------ Move player ------ */
  const dx=target.x-player.x, dy=target.y-player.y, d=Math.hypot(dx,dy);
  const maxV=player.baseSpeed*(1+0.1*(level-1));
  if(d>1){ player.x+=dx/d*maxV; player.y+=dy/d*maxV; }

  /* ------ Update food positions ------ */
  neonFood.forEach(f=>{
    f.angle+=f.angV*dt;
    f.x=Math.cos(f.angle)*f.baseR;
    f.y=Math.sin(f.angle)*f.baseR;
    f.size=2.5+Math.sin(t*0.002+f.seed)*1.5;
  });
  yellowFood.forEach(f=>{
    f.angle+=f.angV*dt;
    f.x=Math.cos(f.angle)*f.baseR;
    f.y=Math.sin(f.angle)*f.baseR;
  });

  /* ------ Collisions ------ */
  function eat(arr, gainFactor=1){
    for(let i=arr.length-1;i>=0;i--){
      const f=arr[i];
      if(Math.hypot(player.x-f.x,player.y-f.y)<player.r+f.size){
        player.mass+=f.size*gainFactor;
        arr.splice(i,1);
      }
    }
  }
  eat(neonFood,1.4);  // neon more rewarding
  eat(yellowFood,1.2);

  /* Respawn logic */
  if(player.r<30 && neonFood.length<80) spawnNeon();
  if(yellowFood.length<60) spawnYellow();

  /* ------ Mass decay ------ */
  const decay=Math.max(0.004,0.00002*player.r*player.r)*(1+0.1*(level-1));
  player.mass=Math.max(5,player.mass-decay*dt);

  /* ------ Size & tail ------ */
  player.r=10+player.mass/15;
  player.tail.unshift({x:player.x,y:player.y});
  if(player.tail.length>player.mass/3) player.tail.pop();

  /* ------ Leveling ------ */
  const newLvl=Math.floor(player.mass/100)+1;
  if(newLvl>level){level=newLvl;flash=30;}

  /* ------ Camera ------ */
  offset.x=W/2-player.x; offset.y=H/2-player.y;
  ctx.setTransform(1,0,0,1,offset.x,offset.y);
  ctx.clearRect(-offset.x,-offset.y,W,H);

  /* ------ Draw background ------ */
  drawTesseract();
  drawNeon(t);
  drawYellow();

  /* ------ Draw player & tail ------ */
  player.tail.forEach((p,i)=>drawCircle(
    {x:p.x,y:p.y,r:player.r*(1-i/player.tail.length)},
    `rgba(0,228,184,${0.7-i/player.tail.length})`));
  drawCircle(player,"#00e4b8");

  /* ------ HUD ------ */
  document.getElementById('mass').textContent=player.mass.toFixed(0);
  document.getElementById('score').textContent=Math.floor(player.mass*10);
  const lvl=document.getElementById('level');
  lvl.textContent=level; lvl.style.color=flash&&flash--%2?"#ff0":"#fff";

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- Render helpers ---------- */
function drawCircle(o,c){
  ctx.fillStyle=c; ctx.beginPath(); ctx.arc(o.x,o.y,o.r,0,Math.PI*2); ctx.fill();
}
function drawNeon(t){
  neonFood.forEach(f=>{
    ctx.globalAlpha=0.7;
    ctx.shadowBlur=12; ctx.shadowColor=f.col;
    ctx.fillStyle=f.col;
    ctx.beginPath(); ctx.arc(f.x,f.y,f.size,0,Math.PI*2); ctx.fill();
    ctx.shadowBlur=0; ctx.globalAlpha=1;
  });
}
function drawYellow(){
  yellowFood.forEach(f=>{
    ctx.globalAlpha=0.8;
    ctx.shadowBlur=8; ctx.shadowColor="#ffea00";
    ctx.fillStyle="#ffea00";
    ctx.beginPath(); ctx.arc(f.x,f.y,f.size,0,Math.PI*2); ctx.fill();
    ctx.shadowBlur=0; ctx.globalAlpha=1;
  });
}

/* --- Tesseract grid: perspective cubes fading out --- */
function drawTesseract(){
  ctx.strokeStyle="#111"; ctx.lineWidth=1.2;
  const step=120, depth=6;
  for(let z=0;z<depth;z++){
    const s=(1+z*0.15);
    const col=`rgba(34,34,34,${0.8-0.12*z})`;
    ctx.strokeStyle=col;
    for(let i=-4;i<=4;i++){
      for(let j=-4;j<=4;j++){
        const x=i*step*s, y=j*step*s;
        cube(x,y,step*s);
      }
    }
  }
  function cube(x,y,s){
    ctx.beginPath();
    ctx.moveTo(x,y); ctx.lineTo(x+s,y);
    ctx.lineTo(x+s,y+s); ctx.lineTo(x,y+s); ctx.closePath(); ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x,y); ctx.lineTo(x-s*0.4,y-s*0.4);
    ctx.lineTo(x-s*0.4+s,y-s*0.4); ctx.lineTo(x+s,y); ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x+s,y); ctx.lineTo(x+s+s*0.4,y-s*0.4);
    ctx.lineTo(x+s+s*0.4-s,y-s*0.4+s); ctx.lineTo(x+s,y+s); ctx.stroke();
  }
}

/* ---------- Music trigger (unchanged) ---------- */
function startMusic(){const a=document.getElementById('backgroundMusic');if(a&&a.paused)a.play().catch(()=>{});}
addEventListener('click',startMusic,{once:true});addEventListener('touchend',startMusic,{once:true});
</script>
</body>
</html>
