<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Genesis Evolution – Neon Glow Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <style>
    html,body {
      margin: 0; padding: 0; height: 100%;
      background: #060616; overflow: hidden;
      font-family: "Inter", Arial, sans-serif;
    }
    canvas {
      display: block; width: 100%; height: 100%;
      touch-action: none;
      background: radial-gradient(circle at center, #32005a 0%, #000 85%);
    }
    #hud {
      position: fixed; top: 14px; left: 18px;
      color: #fff; font-size: 15px;
      text-shadow: 0 0 4px rgba(255,255,255,.3);
    }
    #effBar {
      position: fixed; bottom: 14px; left: 18px;
      width: 220px; height: 18px;
      background: rgba(255,255,255,.12); border-radius: 9px;
    }
    #effFill {
      height: 100%; width: 100%;
      background: #00e4b8; border-radius: 9px;
    }
  </style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud">Mass: <span id="mass">10</span> Score: <span id="score">0</span> Level: <span id="level">1</span></div>
<div id="effBar"><div id="effFill"></div></div>
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>

<script>
/* ---------- Canvas ---------- */
const c=document.getElementById('game'),ctx=c.getContext('2d');
let W,H; function resize(){W=c.width=innerWidth;H=c.height=innerHeight;} resize();
addEventListener('resize',resize);

/* ---------- Player & camera ---------- */
let P={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5};
let tgt={x:0,y:0}, off={x:W/2,y:H/2};

/* ---------- Food & pill ---------- */
const food=[], PILL_COLOR="#ff39ff";
let pill={x:0,y:0,r:10,active:false,cooldown:0};

/* ---------- Frenzy ---------- */
let frenzy=false, frenzyTime=0, F_DURATION=10000;

/* ---------- Utility ---------- */
const rand=()=>Math.random()*1800-900;

/* ---------- Spawn ---------- */
for(let i=0;i<60;i++) food.push({x:rand(),y:rand(),r:6});
function spawnPill(){
  pill={x:rand(),y:rand(),r:10,active:true,cooldown:0};
}

/* ---------- Input ---------- */
["mousedown","touchstart"].forEach(e=>c.addEventListener(e,setT,false));
["mousemove","touchmove"].forEach(e=>c.addEventListener(e,e2=>e2.buttons&&setT(e2),false));
function setT(e){const p=e.touches?e.touches[0]:e;tgt.x=p.clientX-off.x;tgt.y=p.clientY-off.y;e.preventDefault();}

/* ---------- Main loop ---------- */
let last=0,lvl=1,flash=0;
function loop(t){
  const dt=(t-last)||16; last=t;
  
  /* --- Move player --- */
  const dx=tgt.x-P.x,dy=tgt.y-P.y,d=Math.hypot(dx,dy);
  const speed=P.baseSpeed*(1+0.1*(lvl-1))*(frenzy?1.3:1);
  if(d>1){P.x+=dx/d*speed;P.y+=dy/d*speed;}

  /* --- Decay proportional to size² --- */
  const decay=Math.max(0.004,0.00002*P.r*P.r)*(1+0.1*(lvl-1));
  P.mass=Math.max(5,P.mass-decay*dt);

  /* --- Eat food --- */
  for(let i=food.length-1;i>=0;i--){
    const f=food[i];
    const fx=frenzy ? orbitPos(f,t).x : f.x,
          fy=frenzy ? orbitPos(f,t).y : f.y;
    if(Math.hypot(P.x-fx,P.y-fy)<P.r+f.r){
      P.mass+=f.r*1.2; food.splice(i,1);
    }
  }
  while(food.length<60) food.push({x:rand(),y:rand(),r:6});

  /* --- Eat pill --- */
  if(pill.active && Math.hypot(P.x-pill.x,P.y-pill.y)<P.r+pill.r){
    frenzy=true; frenzyTime=F_DURATION; pill.active=false;
  }

  /* --- Frenzy timer --- */
  if(frenzy){
    frenzyTime-=dt;
    if(frenzyTime<=0){ frenzy=false; }
  }else{
    if(!pill.active){ pill.cooldown+=dt; if(pill.cooldown>25000+Math.random()*10000) spawnPill(); }
  }

  /* --- Size & tail --- */
  P.r=10+P.mass/15;
  P.tail.unshift({x:P.x,y:P.y});
  if(P.tail.length>P.mass/3) P.tail.pop();

  /* --- Level check --- */
  const newLvl=Math.floor(P.mass/100)+1;
  if(newLvl>lvl){lvl=newLvl;flash=30;}

  /* --- Camera --- */
  off.x=W/2-P.x; off.y=H/2-P.y;
  ctx.setTransform(1,0,0,1,off.x,off.y);
  ctx.clearRect(-off.x,-off.y,W,H);

  /* --- Background lattice --- */
  drawTesseract();

  /* --- Draw food --- */
  food.forEach(f=>{
    const pos=frenzy?orbitPos(f,t):f;
    drawGlowDot(pos.x,pos.y,f.r,frenzy?"#00e4b8":"#ff0",frenzy?0.8:0.6);
  });

  /* --- Draw pill --- */
  if(pill.active) drawGlowDot(pill.x,pill.y,pill.r,PILL_COLOR,0.9);

  /* --- Draw player & trail --- */
  P.tail.forEach((p,i)=>drawGlowDot(p.x,p.y,P.r*(1-i/P.tail.length),"#00e4b8",0.25));
  drawGlowDot(P.x,P.y,P.r,"#00e4b8",1);

  /* --- HUD --- */
  document.getElementById('mass').textContent=P.mass.toFixed(0);
  document.getElementById('score').textContent=Math.floor(P.mass*10);
  const l=document.getElementById('level');
  l.textContent=frenzy?`FRENZY ${Math.ceil(frenzyTime/1000)}`:lvl;
  l.style.color=frenzy?"#ff39ff":flash&&flash--%2?"#ff0":"#fff";

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- Helpers ---------- */
function orbitPos(f,t){
  const a=f.seed||(f.seed=Math.random()*Math.PI*2);
  const ang=a+t*0.004, r=120+Math.sin(a+t*0.002)*60;
  return {x:Math.cos(ang)*r,y:Math.sin(ang)*r};
}
function drawGlowDot(x,y,r,col,alpha){
  ctx.globalAlpha=alpha;
  ctx.shadowBlur=12; ctx.shadowColor=col;
  ctx.fillStyle=col; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
  ctx.shadowBlur=0; ctx.globalAlpha=1;
}
function drawTesseract(){
  ctx.strokeStyle="#111"; ctx.lineWidth=1.2;
  const step=120, depth=6;
  for(let z=0;z<depth;z++){
    const s=1+z*0.15, opa=0.8-0.12*z;
    ctx.strokeStyle=`rgba(34,34,34,${opa})`;
    for(let i=-4;i<=4;i++) for(let j=-4;j<=4;j++) cube(i*step*s,j*step*s,step*s);
  }
  function cube(x,y,s){
    ctx.beginPath(); ctx.rect(x,y,s,s); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x-s*0.4,y-s*0.4);
    ctx.lineTo(x-s*0.4+s,y-s*0.4); ctx.lineTo(x+s,y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x+s,y); ctx.lineTo(x+s+s*0.4,y-s*0.4);
    ctx.lineTo(x+s+s*0.4-s,y-s*0.4+s); ctx.lineTo(x+s,y+s); ctx.stroke();
  }
}

/* ---------- Music trigger ---------- */
function startMusic(){const a=document.getElementById('backgroundMusic');if(a&&a.paused)a.play().catch(()=>{});}
addEventListener('click',startMusic,{once:true}); addEventListener('touchend',startMusic,{once:true});
</script>
</body>
</html>
