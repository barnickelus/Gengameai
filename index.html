<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Genesis Evolution – Neon Frenzy</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <style>
    html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
    canvas{width:100%;height:100%;display:block;touch-action:none;
           background:radial-gradient(circle at center,#32005a 0%,#000 85%);}
    #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
    #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;
             letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
    #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;
            background:rgba(255,255,255,.12);z-index:2;}
    #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
    #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
    #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
    #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
  </style>
</head>
<body>
<canvas id="game"></canvas>

<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>

<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>

<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>

<script>
/* ===== CONFIG ===== */
const PILL_COLORS=["#00aaff","#ff39ff"];
const MASS_THRESH=600;
const TITAN_LEVEL=10;
const TITAN_MAX=6;
const TITAN_RESPAWN_MS=20000;
const SPECTRE_MAX=3;
const REAPER_MAX=3;
const PERFECT_BONUS=lvl=>Math.min(400,Math.floor(40*Math.sqrt(lvl)));
const FRENZY_BONUS_SCALE=0.4;         // <-- nerf factor
const C_RING_DIST=1600;
const SPECTRE_SPEED_MS=6000;
const SPECTRE_SPEED_MULT=1.25;

/* ===== CANVAS ===== */
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
let W,H;function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}resize();addEventListener('resize',resize);

/* ===== HUD refs ===== */
const massEl=document.getElementById('mass'),scoreEl=document.getElementById('score'),levelEl=document.getElementById('level');
const pauseBtn=document.getElementById('pauseBtn'),radarWrap=document.getElementById('radarWrap'),radar=document.getElementById('radar'),rctx=radar.getContext('2d');

/* ===== PLAYER ===== */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0,speedBoost:0};
let target={x:0,y:0,active:false};
let offset={x:W/2,y:H/2};

/* ===== ENTITIES ===== */
const food=[],foes=[],titans=[],spectres=[],reapers=[],beacons=[];
const COLORS=["#00e4b8","#0ff","#00faff","#22e"];
let pill={x:0,y:0,r:10,active:false,cd:0};
let frenzy=false,F_TIME=0,frenzyOrbsLeft=0,bonusFlash=0;
let paused=false,radarActive=false;

/* ===== Counters ===== */
let titanTimer=0,titanKill=0,spectreKill=0;

/* ===== Utilities ===== */
const rand=v=>Math.random()*v-v/2;
const dist=(ax,ay,bx,by)=>Math.hypot(ax-bx,ay-by);
const lerp=(a,b,t)=>a+(b-a)*t;
const rgb=h=>({r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16)});
function mixHex(a,b,t){const A=rgb(a),B=rgb(b);return`rgb(${Math.round(lerp(A.r,B.r,t))},${Math.round(lerp(A.g,B.g,t))},${Math.round(lerp(A.b,B.b,t))})`;}

/* ===== SPAWNERS ===== */
for(let i=0;i<60;i++)food.push({x:rand(1800),y:rand(1800),r:6});
for(let i=0;i<12;i++)spawnFoe();
['N','S','E','W'].forEach(dir=>{
  const pos={N:[0,-C_RING_DIST],S:[0,C_RING_DIST],E:[C_RING_DIST,0],W:[-C_RING_DIST,0]}[dir];
  beacons.push({x:pos[0],y:pos[1],r:18});
});
function spawnFoe(){foes.push({x:rand(2000),y:rand(2000),r:(player.mass>=MASS_THRESH?14:10)+Math.random()*20});}
function spawnTitan(){const a=Math.random()*Math.PI*2,d=700+Math.random()*500;titans.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:25+Math.random()*35,hop:0});}
function spawnSpectre(){const a=Math.random()*Math.PI*2,d=600+Math.random()*400;spectres.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:22+Math.random()*25,dash:0});}
function spawnReaper(){const a=Math.random()*Math.PI*2,d=800+Math.random()*600;reapers.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:38+Math.random()*28,charge:0});}
function spawnPill(){pill={x:rand(1800),y:rand(1800),r:10,active:true,cd:0};}

/* ===== INPUT ===== */
canvas.addEventListener("pointerdown",e=>{if(!paused){setT(e);target.active=true;}});
canvas.addEventListener("pointermove",e=>{if(target.active&&!paused)setT(e);});
canvas.addEventListener("pointerup",()=>target.active=false);
function setT(p){target.x=p.clientX-offset.x;target.y=p.clientY-offset.y;}

/* ===== PAUSE ===== */
pauseBtn.onclick=()=>{paused=!paused;pauseBtn.textContent=paused?"▶︎":"⏸︎";const m=document.getElementById('backgroundMusic');if(m)paused?m.pause():m.play().catch(()=>{});} ;

/* ===== LOOP ===== */
let last=0,level=1,flash=0;
function loop(ts){
  if(paused){ last=ts; requestAnimationFrame(loop); return; }
  const dt=(ts-last)||16; last=ts;

  /* Movement */
  const dx=(target.active?target.x:player.x)-player.x,dy=(target.active?target.y:player.y)-player.y,dlen=Math.hypot(dx,dy);
  const boostFactor=(player.speedBoost>0?SPECTRE_SPEED_MULT:1)*(frenzy?1.3:1);
  if(dlen>1)player.x+=dx/dlen*player.baseSpeed*(1+0.1*(level-1))*boostFactor,
             player.y+=dy/dlen*player.baseSpeed*(1+0.1*(level-1))*boostFactor;
  if(player.speedBoost>0)player.speedBoost=Math.max(0,player.speedBoost-dt);

  /* Decay */
  const decayRaw=0.000009*player.r*player.r+(player.mass<150?0.002:0.003);
  player.mass=Math.max(5,player.mass-Math.min(decayRaw,0.08)*dt);

  /* Food pick-up & nerfed perfect-frenzy bonus */
  for(let i=food.length-1;i>=0;i--){const f=food[i];
    if(dist(player.x,player.y,f.x,f.y)<player.r+f.r){
      player.mass+=f.r*(f.frenzy?0.6:1.2);
      if(f.frenzy){
        frenzyOrbsLeft--;
        if(frenzyOrbsLeft===0){
          const secs=Math.max(1,Math.ceil(F_TIME/1000));
          player.mass+=PERFECT_BONUS(level)*secs*FRENZY_BONUS_SCALE;
          bonusFlash=60;
        }
      }
      food.splice(i,1);
  }} while(food.length<60)food.push({x:rand(1800),y:rand(1800),r:6});

  /* (foe, titan, spectre, reaper logic unchanged except for radar fix further below) */

  /* Radar drawing – dynamic scale keeps player visible */
  if(radarActive){
    rctx.clearRect(0,0,70,70);rctx.strokeStyle="#666";rctx.lineWidth=1;
    rctx.beginPath();rctx.moveTo(35,0);rctx.lineTo(35,70);rctx.moveTo(0,35);rctx.lineTo(70,35);rctx.stroke();
    const maxCoord=Math.max(C_RING_DIST,Math.abs(player.x),Math.abs(player.y))||1;
    const scale=30/maxCoord;
    const rx=35+player.x*scale,ry=35+player.y*scale;
    rctx.fillStyle="#00e4b8";rctx.beginPath();rctx.arc(rx,ry,3,0,Math.PI*2);rctx.fill();
  }

  /* (rendering, HUD, etc. remain unchanged) */

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ===== Draw helpers (unchanged except drawGlyphR) ===== */
function drawGlyphR(x,y,r,c){
  ctx.save();ctx.shadowBlur=12;ctx.shadowColor=c;ctx.fillStyle=c;
  ctx.font=`${r*2}px Inter`;ctx.textAlign="center";ctx.textBaseline="middle";
  ctx.fillText("R",x,y);ctx.shadowBlur=0;ctx.restore();
}
/*  …rest of helpers and music bootstrap unchanged… */
</script>
</body>
</html>
