<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Genesis Evolution – Zoom Fix</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <style>
    html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
    canvas{width:100%;height:100%;display:block;touch-action:none;
           background:radial-gradient(circle at center,#32005a 0%,#000 85%);}
    #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
    #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;
             letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
    #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;
            background:rgba(255,255,255,.12);z-index:2;}
    #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
    #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
    #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
    #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
    #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2;}
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
  <div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
  <div id="effBar"><div id="effFill"></div></div>
  <div id="pauseBtn">⏸︎</div>
  <div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
  <input id="zoomSlider" type="range" min="0.5" max="2.5" step="0.01" value="1.0">
  <audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
  <script>/* ===== ZOOM CONTROL ===== */
let zoom = 1.0;
const zoomSlider = document.getElementById("zoomSlider");
zoomSlider.addEventListener("input", () => {
  zoom = parseFloat(zoomSlider.value);
});

/* ===== CONSTANTS ===== */
const MASS_THRESH = 600, TITAN_LEVEL = 10, TITAN_MAX = 6, TITAN_RESPAWN_MS = 20000;
const SPECTRE_MAX = 3, REAPER_MAX = 3, C_RING_DIST = 1600;

const PILL_COLORS = ["#00aaff", "#ff39ff"];
const COLORS = ["#00e4b8", "#0ff", "#00faff", "#22e"];

const PERFECT_BONUS = lvl => Math.min(400, Math.floor(40 * Math.sqrt(lvl)));
const FRENZY_BONUS_SCALE = 0.4;
const SPECTRE_SPEED_MS = 6000, SPECTRE_SPEED_MULT = 1.25;

const RADAR_PADDING = 4;

/* ===== CANVAS ===== */
const canvas = document.getElementById("game"), ctx = canvas.getContext("2d");
let W, H;
function resize() {
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ===== HUD refs ===== */
const massEl = document.getElementById("mass"),
      scoreEl = document.getElementById("score"),
      levelEl = document.getElementById("level");
const pauseBtn = document.getElementById("pauseBtn"),
      radarWrap = document.getElementById("radarWrap"),
      radar = document.getElementById("radar"),
      rctx = radar.getContext("2d");

/* ===== PLAYER & WORLD ===== */
let player = { x: 0, y: 0, r: 15, mass: 10, tail: [], baseSpeed: 2.5, blink: 0, speedBoost: 0 };
let target = { x: 0, y: 0, active: false };
let offset = { x: W / 2, y: H / 2 };

const food = [], foes = [], titans = [], spectres = [], reapers = [], beacons = [];
let pill = { x: 0, y: 0, r: 10, active: false, cd: 0 };
let frenzy = false, F_TIME = 0, frenzyOrbsLeft = 0, bonusFlash = 0;
let paused = false, radarActive = false;
let titanTimer = 0, titanKill = 0, spectreKill = 0;

/* ===== UTIL ===== */
const rand = v => Math.random() * v - v / 2;
const dist = (ax, ay, bx, by) => Math.hypot(ax - bx, ay - by);
const lerp = (a, b, t) => a + (b - a) * t;
const rgb = h => ({ r: parseInt(h.slice(1, 3), 16), g: parseInt(h.slice(3, 5), 16), b: parseInt(h.slice(5, 7), 16) });
function mixHex(a, b, t) {
  const A = rgb(a), B = rgb(b);
  return `rgb(${Math.round(lerp(A.r, B.r, t))},${Math.round(lerp(A.g, B.g, t))},${Math.round(lerp(A.b, B.b, t))})`;
}/* ===== INPUT ===== */
canvas.addEventListener("pointerdown", e => {
  if (!paused) { setT(e); target.active = true; }
});
canvas.addEventListener("pointermove", e => {
  if (target.active && !paused) setT(e);
});
canvas.addEventListener("pointerup", () => target.active = false);
function setT(p) {
  target.x = p.clientX - offset.x;
  target.y = p.clientY - offset.y;
}

/* ===== PAUSE ===== */
pauseBtn.onclick = () => {
  paused = !paused;
  pauseBtn.textContent = paused ? "▶︎" : "⏸︎";
  const m = document.getElementById('backgroundMusic');
  if (m) paused ? m.pause() : m.play().catch(() => {});
};

/* ===== GAME LOOP ===== */
let last = 0, level = 1, flash = 0;
function loop(ts) {
  if (paused) { last = ts; requestAnimationFrame(loop); return; }
  const dt = (ts - last) || 16; last = ts;

  // Adjust canvas transform by zoom level
  ctx.setTransform(zoom, 0, 0, zoom, offset.x, offset.y);
  ctx.clearRect(-offset.x / zoom, -offset.y / zoom, W / zoom, H / zoom);

  /* --- Movement --- */
  const dx = (target.active ? target.x : player.x) - player.x;
  const dy = (target.active ? target.y : player.y) - player.y;
  const dlen = Math.hypot(dx, dy);

  if (player.speedBoost > 0) player.speedBoost = Math.max(0, player.speedBoost - dt);
  const boostFactor = (player.speedBoost > 0 ? SPECTRE_SPEED_MULT : 1) * (frenzy ? 1.3 : 1);

  if (dlen > 1) {
    const sp = player.baseSpeed * (1 + 0.1 * (level - 1)) * boostFactor / zoom;
    player.x += dx / dlen * sp;
    player.y += dy / dlen * sp;
  }

  /* --- Mass decay --- */
  const decayRaw = 0.000009 * player.r * player.r + (player.mass < 150 ? 0.002 : 0.003);
  player.mass = Math.max(5, player.mass - Math.min(decayRaw, 0.08) * dt);

  /* --- Food --- */
  for (let i = food.length - 1; i >= 0; i--) {
    const f = food[i];
    if (dist(player.x, player.y, f.x, f.y) < player.r + f.r) {
      player.mass += f.r * (f.frenzy ? 0.6 : 1.2);
      if (f.frenzy) {
        frenzyOrbsLeft--;
        if (frenzyOrbsLeft === 0) {
          const secs = Math.max(1, Math.ceil(F_TIME / 1000));
          player.mass += PERFECT_BONUS(level) * secs * FRENZY_BONUS_SCALE;
          bonusFlash = 60;
        }
      }
      food.splice(i, 1);
    }
  }
  while (food.length < 60) food.push({ x: rand(1800), y: rand(1800), r: 6 });

  // Restore original player compression when small
  player.r = player.mass < 30 ? 10 + player.mass / 3 : 10 + player.mass / 15;
  player.tail.unshift({ x: player.x, y: player.y });
  if (player.tail.length > player.mass / 3) player.tail.pop();

  // Update level and flashing
  const newLv = Math.floor(player.mass / 100) + 1;
  if (newLv > level) { level = newLv; flash = 30; }
  if (player.blink > 0) player.blink -= dt;

  // Update offset based on zoom
  offset.x = W / 2 - player.x * zoom;
  offset.y = H / 2 - player.y * zoom;

  // Draw world elements here...  /* --- Draw background tesseract --- */
  drawTesseract();

  /* --- Draw food & powerups --- */
  food.forEach(f => drawGlow(f.x, f.y, f.r, f.frenzy ? f.col : "#ff0", f.frenzy ? 0.8 : 0.65));
  if (pill.active) {
    const ph = (Math.sin(ts * 0.005) + 1) / 2;
    drawGlow(pill.x, pill.y, pill.r, mixHex(PILL_COLORS[0], PILL_COLORS[1], ph), 0.95);
  }

  /* --- Draw tail and player --- */
  player.tail.forEach((p, i) =>
    drawGlow(p.x, p.y, player.r * (1 - i / player.tail.length),
             mixHex("#00e4b8", "#ff39ff", i / player.tail.length), 0.3)
  );
  drawGlow(player.x, player.y, player.r,
           player.blink > 0 ? (player.blink % 200 < 100 ? "#fff" : "#ff44ff") : "#00e4b8", 1);

  /* --- Draw radar --- */
  if (radarActive) {
    rctx.clearRect(0, 0, 70, 70);
    rctx.strokeStyle = "#666";
    rctx.lineWidth = 1;
    rctx.beginPath();
    rctx.moveTo(35, 0); rctx.lineTo(35, 70);
    rctx.moveTo(0, 35); rctx.lineTo(70, 35);
    rctx.stroke();

    const maxCoord = Math.max(C_RING_DIST, Math.abs(player.x), Math.abs(player.y)) || 1;
    const scale = (30 - RADAR_PADDING) / maxCoord;
    const rx = 35 + player.x * scale, ry = 35 + player.y * scale;
    rctx.fillStyle = "#00e4b8";
    rctx.beginPath();
    rctx.arc(rx, ry, 3, 0, Math.PI * 2);
    rctx.fill();
  }

  /* --- HUD update --- */
  massEl.textContent = player.mass.toFixed(0);
  scoreEl.textContent = Math.floor(player.mass * 10);
  levelEl.textContent = frenzy ? `FRENZY ${Math.ceil(F_TIME / 1000)}` : level;
  levelEl.style.color = bonusFlash && bonusFlash-- % 2 ? "#ff0" :
                        frenzy ? "#ff39ff" :
                        flash && flash-- % 2 ? "#ff0" : "#fff";

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ===== DRAW HELPERS ===== */
function drawGlow(x, y, r, c, a) {
  ctx.globalAlpha = a;
  ctx.shadowBlur = 12;
  ctx.shadowColor = c;
  ctx.fillStyle = c;
  ctx.beginPath();
  ctx.arc(x, y, r, 0, Math.PI * 2);
  ctx.fill();
  ctx.shadowBlur = 0;
  ctx.globalAlpha = 1;
}

function drawGlyphR(x, y, r, c) {
  ctx.save();
  ctx.shadowBlur = 12;
  ctx.shadowColor = c;
  ctx.fillStyle = c;
  ctx.font = `${r * 2}px Inter`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("R", x, y);
  ctx.shadowBlur = 0;
  ctx.restore();
}

function drawTesseract() {
  ctx.lineWidth = 1.2;
  const step = 120, d = 6;
  for (let z = 0; z < d; z++) {
    const s = 1 + z * 0.15, o = 0.8 - 0.12 * z;
    ctx.strokeStyle = `rgba(34,34,34,${o})`;
    for (let i = -4; i <= 4; i++)
      for (let j = -4; j <= 4; j++)
        cube(i * step * s, j * step * s, step * s);
  }
  function cube(x, y, s) {
    ctx.beginPath(); ctx.rect(x, y, s, s); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x, y);
    ctx.lineTo(x - s * 0.4, y - s * 0.4);
    ctx.lineTo(x - s * 0.4 + s, y - s * 0.4);
    ctx.lineTo(x + s, y); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x + s, y);
    ctx.lineTo(x + s + s * 0.4, y - s * 0.4);
    ctx.lineTo(x + s + s * 0.4 - s, y - s * 0.4 + s);
    ctx.lineTo(x + s, y + s); ctx.stroke();
  }
}

/* ===== MUSIC ===== */
function startMusic() {
  const a = document.getElementById("backgroundMusic");
  if (a && a.paused) a.play().catch(() => {});
}
addEventListener("pointerdown", () => {
  if (!paused) startMusic();
}, { once: true });
</script>

</body>
</html>